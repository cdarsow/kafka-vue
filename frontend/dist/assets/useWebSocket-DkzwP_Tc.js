import{j as o,l as c}from"./index-BWgzGCG0.js";class r{ws=null;url;reconnectInterval=5e3;maxReconnectAttempts=5;messages=o([]);status=c({isConnected:!1,isConnecting:!1,error:null,reconnectAttempts:0});constructor(e="ws://localhost:3000"){this.url=e}connect(){if(this.ws?.readyState===WebSocket.OPEN){console.log("WebSocket is already connected");return}this.status.isConnecting=!0,this.status.error=null;try{this.ws=new WebSocket(this.url),this.setupEventListeners()}catch{this.handleError("Failed to create WebSocket connection")}}setupEventListeners(){this.ws&&(this.ws.onopen=()=>{console.log("WebSocket connected"),this.status.isConnected=!0,this.status.isConnecting=!1,this.status.error=null,this.status.reconnectAttempts=0},this.ws.onmessage=e=>{try{const s=JSON.parse(e.data);this.messages.value.push(s),console.log("Received message:",s)}catch(s){console.error("Failed to parse message:",s),this.handleError("Failed to parse incoming message")}},this.ws.onclose=e=>{console.log("WebSocket disconnected:",e.code,e.reason),this.status.isConnected=!1,this.status.isConnecting=!1,e.code!==1e3&&this.status.reconnectAttempts<this.maxReconnectAttempts&&this.reconnect()},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.handleError("WebSocket connection error")})}reconnect(){this.status.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.status.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect()},this.reconnectInterval)}handleError(e){this.status.error=e,this.status.isConnecting=!1,this.status.isConnected=!1}sendMessage(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){this.handleError("WebSocket is not connected");return}try{const s={type:"user",message:e,timestamp:new Date().toISOString()};this.ws.send(JSON.stringify(s)),console.log("Sent message:",s)}catch(s){console.error("Failed to send message:",s),this.handleError("Failed to send message")}}disconnect(){this.ws&&(this.ws.close(1e3,"Client initiated disconnect"),this.ws=null),this.status.isConnected=!1,this.status.isConnecting=!1}clearMessages(){this.messages.value=[]}}const t=new r;function a(){return{messages:t.messages,status:t.status,connect:()=>t.connect(),disconnect:()=>t.disconnect(),sendMessage:n=>t.sendMessage(n),clearMessages:()=>t.clearMessages()}}export{a as u};
